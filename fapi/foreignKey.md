В SQLAlchemy параметр ForeignKey (внешний ключ) используется для указания связи между таблицами в базе данных. При создании внешнего ключа в SQLAlchemy вы можете указать различные параметры, чтобы контролировать поведение этой связи.
Основные параметры ForeignKey

ForeignKey(требуемая колонка):  
Это обязательный параметр, в который передается ссылка на колонку,
на которую ссылается внешний ключ.  
        Формат: "таблица.колонка".  

Пример:  
```
Column(Integer, ForeignKey("users.id"))
```
**ondelete**:  

Указывает поведение при удалении строки в родительской таблице.  
Возможные значения:  
        **"CASCADE"** — удаление строки в родительской таблице приведет к удалению всех связанных строк в дочерней таблице.  
        **"SET NULL"** — при удалении строки в родительской таблице внешний ключ будет установлен в NULL в дочерней таблице.  
        **"RESTRICT"** — запрещает удаление строки в родительской таблице, если существуют связанные строки в дочерней таблице.  
        **"NO ACTION"** — стандартное поведение, при котором ничего не происходит, если удаление не нарушает ограничений.  

Пример:  

>Column(Integer, ForeignKey("users.id", ondelete="CASCADE"))

**onupdate**:

Указывает поведение при обновлении строки в родительской таблице.   
Возможные значения:  
        **"CASCADE"** — при изменении значения ключевого поля в родительской таблице оно автоматически изменится в дочерней таблице.  
        **"SET NULL"** — при изменении значения родительского ключа внешний ключ в дочерней таблице будет установлен в NULL.  
        **"RESTRICT"** — запрещает изменение строки в родительской таблице, если существуют связанные строки в дочерней таблице.  
        **"NO ACTION"** — стандартное поведение, когда ничего не происходит.  

Пример:

>Column(Integer, ForeignKey("users.id", onupdate="CASCADE"))

**name:**
Позволяет задать имя для внешнего ключа в базе данных.  

Пример:  

>Column(Integer, ForeignKey("users.id", name="fk_user_id"))

**deferrable:**

Указывает, может ли проверка внешнего ключа быть отложена 
(например, проверка может быть выполнена в конце транзакции).  
Принимает значения True или False.  

Пример:  

>Column(Integer, ForeignKey("users.id", deferrable=True))

**initially:**

Используется совместно с параметром deferrable. Указывает, как 
будет проверяться внешний ключ на этапе начала транзакции.  
Возможные значения:    
        **"IMMEDIATE"** — проверка происходит сразу.
        **"DEFERRED"** — проверка откладывается до конца транзакции.

Пример:  

>Column(Integer, ForeignKey("users.id", deferrable=True, initially="DEFERRED"))

**use_alter:**

Используется для создания внешнего ключа с помощью 
отдельной команды ALTER TABLE, а не во время создания таблицы. 
Это может быть полезно при циклических зависимостях между таблицами.   
Принимает значения True или False.  

Пример:  

>Column(Integer, ForeignKey("users.id", use_alter=True))

**link_to_name:**

Указывает, что внешние ключи должны ссылаться только на имена колонок,
а не на сами объекты колонок.  
Принимает значения True или False.  

Пример:  

>Column(Integer, ForeignKey("users.id", link_to_name=True))

Пример с несколькими параметрами  

```
from sqlalchemy import Column, Integer, String, ForeignKey
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

class User(Base):
    __tablename__ = 'users'
    id = Column(Integer, primary_key=True)
    name = Column(String)

class Address(Base):
    __tablename__ = 'addresses'
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey('users.id', ondelete="CASCADE", onupdate="CASCADE", name="fk_user_address"))
    address = Column(String)
```
Заключение  

Параметры ForeignKey в SQLAlchemy позволяют
детально управлять поведением внешних ключей, 
что может быть полезно при создании сложных схем баз данных. 
Использование таких параметров, как ondelete и onupdate, 
помогает контролировать каскадные операции, 
а параметры deferrable и initially — гибко управлять проверками внешних ключей.

[Назад ...](sqlalchemy_and_alembic.md)